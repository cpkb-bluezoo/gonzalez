<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 650 420" width="650" height="420">
  <defs>
    <marker id="flowArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4a5568"/>
    </marker>
    <linearGradient id="analyzerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ebf8ff;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#90cdf4;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="classGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#faf5ff;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d6bcfa;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="decisionGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fffaf0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fbd38d;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="accumulatorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f0fff4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#9ae6b4;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="bufferGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fff5f5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#feb2b2;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <style>
    .header { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px; font-weight: 600; fill: #2d3748; }
    .label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 11px; font-weight: 500; fill: #4a5568; }
    .sublabel { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 9px; fill: #718096; }
    .decision { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 10px; fill: #744210; }
    .yesno { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 10px; font-weight: 600; fill: #2d3748; }
  </style>
  
  <!-- Compile-Time Analysis box (top) -->
  <rect x="125" y="20" width="400" height="60" rx="8" fill="url(#analyzerGrad)" stroke="#3182ce" stroke-width="2"/>
  <text x="325" y="45" text-anchor="middle" class="header">Compile-Time Analysis</text>
  <text x="325" y="62" text-anchor="middle" class="sublabel">StreamabilityAnalyzer examines expressions and templates</text>
  
  <!-- Connector down from analyzer -->
  <line x1="325" y1="80" x2="325" y2="100" stroke="#4a5568" stroke-width="1.5"/>
  
  <!-- Horizontal split line -->
  <line x1="130" y1="100" x2="520" y2="100" stroke="#4a5568" stroke-width="1.5"/>
  
  <!-- Three branches down -->
  <line x1="130" y1="100" x2="130" y2="120" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  <line x1="325" y1="100" x2="325" y2="120" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  <line x1="520" y1="100" x2="520" y2="120" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  
  <!-- MOTIONLESS classification -->
  <rect x="55" y="130" width="150" height="70" rx="6" fill="url(#classGrad)" stroke="#805ad5" stroke-width="1.5"/>
  <text x="130" y="155" text-anchor="middle" class="label">MOTIONLESS</text>
  <text x="130" y="173" text-anchor="middle" class="sublabel">No navigation required</text>
  <text x="130" y="188" text-anchor="middle" class="sublabel">e.g., position(), $var</text>
  
  <!-- CONSUMING classification -->
  <rect x="250" y="130" width="150" height="70" rx="6" fill="url(#classGrad)" stroke="#805ad5" stroke-width="1.5"/>
  <text x="325" y="155" text-anchor="middle" class="label">CONSUMING</text>
  <text x="325" y="173" text-anchor="middle" class="sublabel">Forward traversal only</text>
  <text x="325" y="188" text-anchor="middle" class="sublabel">e.g., child::*, .//item</text>
  
  <!-- GROUNDED classification -->
  <rect x="445" y="130" width="150" height="70" rx="6" fill="url(#classGrad)" stroke="#805ad5" stroke-width="1.5"/>
  <text x="520" y="155" text-anchor="middle" class="label">GROUNDED</text>
  <text x="520" y="173" text-anchor="middle" class="sublabel">Needs subtree access</text>
  <text x="520" y="188" text-anchor="middle" class="sublabel">e.g., preceding-sibling::*</text>
  
  <!-- Connectors merging -->
  <line x1="130" y1="200" x2="130" y2="220" stroke="#4a5568" stroke-width="1"/>
  <line x1="325" y1="200" x2="325" y2="220" stroke="#4a5568" stroke-width="1"/>
  <line x1="520" y1="200" x2="520" y2="220" stroke="#4a5568" stroke-width="1"/>
  
  <!-- Horizontal merge line -->
  <line x1="130" y1="220" x2="520" y2="220" stroke="#4a5568" stroke-width="1"/>
  
  <!-- Single line down to decision -->
  <line x1="325" y1="220" x2="325" y2="250" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  
  <!-- Decision diamond -->
  <polygon points="325,260 425,295 325,330 225,295" fill="url(#decisionGrad)" stroke="#d69e2e" stroke-width="2"/>
  <text x="325" y="290" text-anchor="middle" class="decision">Can accumulator</text>
  <text x="325" y="304" text-anchor="middle" class="decision">handle it?</text>
  
  <!-- Yes branch (left) -->
  <line x1="225" y1="295" x2="160" y2="295" stroke="#4a5568" stroke-width="1.5"/>
  <line x1="160" y1="295" x2="160" y2="350" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  <text x="190" y="285" class="yesno">Yes</text>
  
  <!-- No branch (right) -->
  <line x1="425" y1="295" x2="490" y2="295" stroke="#4a5568" stroke-width="1.5"/>
  <line x1="490" y1="295" x2="490" y2="350" stroke="#4a5568" stroke-width="1.5" marker-end="url(#flowArrow)"/>
  <text x="455" y="285" class="yesno">No</text>
  
  <!-- Use Accumulator result -->
  <rect x="70" y="360" width="180" height="50" rx="6" fill="url(#accumulatorGrad)" stroke="#38a169" stroke-width="2"/>
  <text x="160" y="382" text-anchor="middle" class="label">Use Accumulator</text>
  <text x="160" y="398" text-anchor="middle" class="sublabel">Pure streaming execution</text>
  
  <!-- Buffer Subtree result -->
  <rect x="400" y="360" width="180" height="50" rx="6" fill="url(#bufferGrad)" stroke="#e53e3e" stroke-width="2"/>
  <text x="490" y="382" text-anchor="middle" class="label">Buffer Subtree</text>
  <text x="490" y="398" text-anchor="middle" class="sublabel">GroundedExecutor captures events</text>
</svg>
